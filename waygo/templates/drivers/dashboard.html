{% extends "base.html" %}

{% block title %}
–í–æ–¥—ñ—è
{% endblock %}

{% block content %}

{% load static %}

<div class="container mt-5">
    <h2 class="fw-bold">üöï –ö–∞–±—ñ–Ω–µ—Ç –≤–æ–¥—ñ—è</h2>

    <div class="card bg-light text-dark mt-4 p-4">
        <p><b>–ê–≤—Ç–æ:</b> {{ driver.car_model }}</p>
        <p><b>–ù–æ–º–µ—Ä:</b> {{ driver.car_number }}</p>
        <p><b>–°—Ç–∞—Ç—É—Å:</b>
            <span id="driver-status" class="{% if driver.is_online %}text-success{% else %}text-danger{% endif %}">
                {% if driver.is_online %}–û–Ω–ª–∞–π–Ω{% else %}–û—Ñ–ª–∞–π–Ω{% endif %}
            </span>
        </p>

        <button id="toggle-online-btn" class="btn {% if driver.is_online %}btn-danger{% else %}btn-success{% endif %}"> 
            {% if driver.is_online %}üî¥ –í–∏–π—Ç–∏ –æ—Ñ–ª–∞–π–Ω{% else %}üü¢ –í–∏–π—Ç–∏ –æ–Ω–ª–∞–π–Ω{% endif %}
        </button>
    </div>

    <a href="{% url 'logout' %}" class="btn btn-outline-light mt-4">–í–∏–π—Ç–∏</a>
</div>
<script>
    const btn = document.getElementById('toggle-online-btn');
    const statusText = document.getElementById('driver-status');

    btn.addEventListener('click', () => {
        fetch("{% url 'toggle-online' %}", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "Accept": "application/json"
            }
        })
        .then(response => response.json())
        .then(data => {
            if(data.is_online){
                statusText.textContent = "–û–Ω–ª–∞–π–Ω";
                statusText.classList.remove("text-danger");
                statusText.classList.add("text-success");

                btn.textContent = "üî¥ –í–∏–π—Ç–∏ –æ—Ñ–ª–∞–π–Ω";
                btn.classList.remove("btn-success");
                btn.classList.add("btn-danger");
            } else {
                statusText.textContent = "–û—Ñ–ª–∞–π–Ω";
                statusText.classList.remove("text-success");
                statusText.classList.add("text-danger");

                btn.textContent = "üü¢ –í–∏–π—Ç–∏ –æ–Ω–ª–∞–π–Ω";
                btn.classList.remove("btn-danger");
                btn.classList.add("btn-success");
            }
        })
        .catch(error => console.error("–ü–æ–º–∏–ª–∫–∞:", error));
    });
</script>
{% endblock %}